<!DOCTYPE html>
<html>
<head>
    <title>Bubble Pop Adventures</title>
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-title" content="Bubble Pop Adventures">
    <meta name="application-name" content="Bubble Pop Adventures">
    <link rel="apple-touch-icon" href="icon.png" />
    <link rel="shortcut icon" href="icon.png" />
    <link rel="icon" href="icon.png" />
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="initial-scale=1.0001, minimum-scale=1.0001, maximum-scale=1.0001, user-scalable=no, minimal-ui" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <link rel="stylesheet" type="text/css" href="game.css">
    <script type="text/javascript" src="/games/gamezoe-save-sdk.js"></script>
    <script type="text/javascript" src="game.js"></script>
    <script type="text/javascript">
    // GameZoe 雲端存檔整合
    (function() {
        const GAME_ID = 'bubble-mush';
        const LOCAL_KEY = 'levelBubble';

        // 初始化並同步雲端存檔
        GameZoeSave.init(GAME_ID).then(async () => {
            if (GameZoeSave.isUserLoggedIn()) {
                // 從雲端讀取存檔
                const cloudSave = await GameZoeSave.load();
                if (cloudSave) {
                    // 比較雲端和本地存檔，使用較新的
                    const localSave = localStorage.getItem(LOCAL_KEY);
                    if (!localSave) {
                        localStorage.setItem(LOCAL_KEY, JSON.stringify(cloudSave));
                        console.log('[BubbleMush] 已從雲端恢復存檔');
                    }
                }
            }
        });

        // 攔截 localStorage.setItem 來同步到雲端
        const originalSetItem = localStorage.setItem.bind(localStorage);
        localStorage.setItem = function(key, value) {
            originalSetItem(key, value);
            if (key === LOCAL_KEY && GameZoeSave.isUserLoggedIn()) {
                try {
                    GameZoeSave.save(JSON.parse(value));
                } catch (e) {
                    GameZoeSave.save(value);
                }
            }
        };
    })();
    </script>
</head>

<body onload="setTimeout(function(){window.scrollTo(0,1)},1);">
    <div class="gamecenter-activator"></div>


    <div id="ajaxbar">
        <div id="game"><canvas id="canvas"></canvas><canvas id="bgcanvas" width=480 height=640></canvas></div>
        <div id="orientate"><img src="media/graphics/orientate/landscape.png" /></div>
        <div id="play" class="play" onclick=""><img src="media/graphics/splash/mobile/cover-start.png" /></div>
    </div>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•†äººç‰©èª (Merchant Story) - é‡è£½ç‰ˆ</title>
    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', serif;
            background: #f0fdf4;
            color: #1e293b;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        #game-container {
            width: 100%;
            max-width: 600px;
            background: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }

        header {
            background: #166534;
            color: white;
            padding: 1rem;
            text-align: center;
        }

        header h1 {
            margin: 0;
            font-size: 1.5rem;
        }

        #stats-bar {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 1rem;
            background: #dcfce7;
            border-bottom: 1px solid #86efac;
            font-weight: bold;
        }

        #main-area {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
        }

        .card {
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            background: #fff;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .market-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #f1f5f9;
        }

        .market-item:last-child {
            border-bottom: none;
        }

        .price-up {
            color: #ef4444;
        }

        .price-down {
            color: #22c55e;
        }

        button {
            background: #166534;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            cursor: pointer;
            transition: 0.2s;
        }

        button:hover {
            background: #15803d;
        }

        button:disabled {
            background: #cbd5e1;
            cursor: not-allowed;
        }

        .actions {
            display: flex;
            gap: 0.5rem;
        }

        #log-area {
            height: 100px;
            overflow-y: scroll;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            padding: 0.5rem;
            font-size: 0.85rem;
            color: #64748b;
        }

        .screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .hidden {
            display: none !important;
        }

        .btn-lg {
            font-size: 1.5rem;
            padding: 1rem 3rem;
            margin-top: 2rem;
            border-radius: 2rem;
        }

        .red-text {
            color: #ef4444;
            font-weight: bold;
        }
    </style>
</head>

<body>

    <div id="game-container">
        <header>
            <h1>å•†äººç‰©èª (é‡è£½ç‰ˆ)</h1>
            <div style="font-size: 0.8rem; opacity: 0.8">ç›®æ¨™ï¼šåœ¨ 30 å¤©å…§è³ºå– $1,000,000</div>
        </header>

        <div id="stats-bar">
            <span>ğŸ“… ç¬¬ <span id="day-display">1</span> å¤©</span>
            <span>ğŸ’° $<span id="money-display">1000</span></span>
            <span>ğŸ“¦ <span id="inventory-display">0</span>/50</span>
        </div>

        <div id="main-area">
            <div class="card">
                <h3>ğŸ™ï¸ åŸé®å¸‚å ´ (åƒ¹æ ¼æ¯æ—¥è®Šå‹•)</h3>
                <div id="market-list"></div>
            </div>

            <div class="card" style="background: #fdf2f8;">
                <h3>ğŸ’ æˆ‘çš„å€‰åº«</h3>
                <div id="inventory-list">æ²’æœ‰è²¨ç‰©</div>
            </div>

            <button id="next-day-btn" style="width: 100%; padding: 1rem; font-size: 1.2rem; background: #2563eb;">ğŸŒ™
                çµæŸé€™ä¸€å¤© (å‰å¾€æ˜å¤©)</button>
        </div>

        <div id="log-area"></div>
    </div>

    <!-- Start / End Screens -->
    <div id="start-screen" class="screen">
        <h1 style="color: #4ade80; font-size: 3rem; margin-bottom: 0;">å•†äººç‰©èª</h1>
        <p>ä½è²·é«˜è³£ï¼Œæˆç‚ºå‚³å¥‡å¤§äº¨ï¼</p>
        <button class="btn-lg" onclick="startGame()">é–‹å§‹ç¶“å•†</button>
    </div>

    <div id="end-screen" class="screen hidden">
        <h1 id="end-title">éŠæˆ²çµæŸ</h1>
        <p id="end-message"></p>
        <p>æœ€çµ‚è³‡é‡‘: $<span id="final-money"></span></p>
        <button class="btn-lg" onclick="location.reload()">é‡æ–°æŒ‘æˆ°</button>
    </div>

    <script>
        // Game State
        const MAX_DAYS = 30;
        const TARGET_MONEY = 1000000;
        let day = 1;
        let money = 1000;
        let capacity = 50;
        let currentCapacity = 0;

        // Item Definitions
        const items = [
            { id: 'apple', name: 'ğŸ æ–°é®®è˜‹æœ', basePrice: 10, volatility: 5 },
            { id: 'cloth', name: 'ğŸ‘• äºéº»å¸ƒæ–™', basePrice: 50, volatility: 20 },
            { id: 'sword', name: 'âš”ï¸ éµè£½é•·åŠ', basePrice: 200, volatility: 80 },
            { id: 'gem', name: 'ğŸ’ ç¥ç§˜å¯¶çŸ³', basePrice: 1000, volatility: 500 },
            { id: 'ancient', name: 'ğŸº å¤ä»£éºç‰©', basePrice: 5000, volatility: 3000 }
        ];

        let marketPrices = {};
        let inventory = {};

        // Init
        items.forEach(i => {
            inventory[i.id] = 0;
            updatePrice(i);
        });

        // DOM Elements
        const moneyEl = document.getElementById('money-display');
        const dayEl = document.getElementById('day-display');
        const capEl = document.getElementById('inventory-display');
        const marketListEl = document.getElementById('market-list');
        const invListEl = document.getElementById('inventory-list');
        const logEl = document.getElementById('log-area');

        function startGame() {
            document.getElementById('start-screen').classList.add('hidden');
            renderMarket();
            log("éŠæˆ²é–‹å§‹ï¼ç¥ä½ ç”Ÿæ„èˆˆéš†ï¼");
        }

        function updatePrice(item) {
            // Random fluctuation: -50% to +50%
            const factor = 0.5 + Math.random();
            marketPrices[item.id] = Math.floor(item.basePrice * factor);
        }

        function nextDay() {
            if (day >= MAX_DAYS) {
                endGame();
                return;
            }

            day++;
            // Price Updates
            items.forEach(i => updatePrice(i));

            // Random Events
            const rand = Math.random();
            if (rand < 0.1) {
                log("ğŸ”¥ å€‰åº«ç™¼ç”Ÿå°ç«ç½ï¼æå¤±äº†ä¸€äº›è²¨ç‰©...", true);
                // Lose 1 random item
                const keys = Object.keys(inventory).filter(k => inventory[k] > 0);
                if (keys.length > 0) {
                    const k = keys[Math.floor(Math.random() * keys.length)];
                    inventory[k] = Math.max(0, inventory[k] - 5);
                }
            } else if (rand > 0.9) {
                log("ğŸ“° å¸‚å ´å‚³èï¼šå¯¶çŸ³åƒ¹æ ¼æš´æ¼²ï¼", true);
                marketPrices['gem'] *= 2;
            }

            updateUI();
            log(`ç¬¬ ${day} å¤©é–‹å§‹ã€‚å¸‚å ´åƒ¹æ ¼å·²æ›´æ–°ã€‚`);
        }

        function buy(itemId) {
            const price = marketPrices[itemId];
            if (money >= price && currentCapacity < capacity) {
                money -= price;
                inventory[itemId]++;
                currentCapacity++;
                updateUI();
                log(`è²·å…¥ ${items.find(i => i.id === itemId).name} (-$${price})`);
            } else {
                if (money < price) log("è³‡é‡‘ä¸è¶³ï¼", true);
                else log("å€‰åº«å·²æ»¿ï¼", true);
            }
        }

        function sell(itemId) {
            if (inventory[itemId] > 0) {
                const price = marketPrices[itemId];
                money += price;
                inventory[itemId]--;
                currentCapacity--;
                updateUI();
            }
        }

        function updateUI() {
            // Recalculate capacity to prevent desync bugs (e.g. after fire event)
            currentCapacity = Object.values(inventory).reduce((a, b) => a + b, 0);

            moneyEl.innerText = money.toLocaleString();
            dayEl.innerText = day;
            capEl.innerText = currentCapacity;

            renderMarket();
            renderInventory();
        }

        function renderMarket() {
            marketListEl.innerHTML = '';
            items.forEach(item => {
                const price = marketPrices[item.id];
                const diff = price - item.basePrice;
                const priceClass = diff > 0 ? 'price-up' : 'price-down';
                const div = document.createElement('div');
                div.className = 'market-item';
                div.innerHTML = `
                    <div>
                        <div style="font-weight:bold">${item.name}</div>
                        <div style="font-size:0.9rem; color:#64748b">åŸºæº–åƒ¹: $${item.basePrice}</div>
                    </div>
                    <div style="text-align:right">
                        <div style="font-weight:bold; font-size:1.1rem" class="${priceClass}">$${price.toLocaleString()}</div>
                        <div class="actions">
                            <button onclick="buy('${item.id}')">è²·å…¥</button>
                        </div>
                    </div>
                `;
                marketListEl.appendChild(div);
            });
        }

        function renderInventory() {
            const owned = items.filter(i => inventory[i.id] > 0);
            if (owned.length === 0) {
                invListEl.innerHTML = "æ²’æœ‰è²¨ç‰©";
                return;
            }
            invListEl.innerHTML = '';
            owned.forEach(item => {
                const count = inventory[item.id];
                const price = marketPrices[item.id];
                const div = document.createElement('div');
                div.className = 'market-item';
                div.innerHTML = `
                    <div>
                        <div style="font-weight:bold">${item.name}</div>
                        <div style="color:#166534">æŒæœ‰: ${count}</div>
                    </div>
                    <div>
                        <button onclick="sell('${item.id}')" style="background:#eab308; color:#000">è³£å‡º ($${price})</button>
                    </div>
                `;
                invListEl.appendChild(div);
            });
        }

        function log(msg, isUrgent = false) {
            const p = document.createElement('div');
            p.innerText = msg;
            if (isUrgent) p.className = 'red-text';
            logEl.prepend(p);
        }

        function endGame() {
            const endScreen = document.getElementById('end-screen');
            const endTitle = document.getElementById('end-title');
            const endMsg = document.getElementById('end-message');
            document.getElementById('final-money').innerText = money.toLocaleString();

            endScreen.classList.remove('hidden');
            if (money >= TARGET_MONEY) {
                endTitle.innerText = "ğŸ† å•†æ¥­å‚³å¥‡ï¼";
                endTitle.style.color = "#fbbf24";
                endMsg.innerText = "ä½ æˆåŠŸé”æˆäº†ç™¾è¬å¯Œç¿çš„ç›®æ¨™ï¼";
                // Submit Score logic here if needed
            } else {
                endTitle.innerText = "ç¶“å•†å¤±æ•—";
                endTitle.style.color = "#94a3b8";
                endMsg.innerText = `è·é›¢ç›®æ¨™ $${TARGET_MONEY.toLocaleString()} é‚„å·®ä¸€é»...`;
            }
        }

        document.getElementById('next-day-btn').onclick = nextDay;

    </script>
</body>

</html>